<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest! - Login</title>

    <!-- Estilo principal -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Melhorias de SEO -->
    <meta name="description" content="Quest! - Plataforma inteligente para criação de questões. Faça login para acessar seu painel.">
</head>
<body class="login-page-body">
    <main class="login-container" id="loginContainer">

        <!-- Boas-vindas -->
        <section class="welcome-container" id="welcomeContainer" hidden>
            <img id="welcomeAvatar" src="{{ url_for('static', filename='images/default-avatar.svg') }}" alt="Avatar do usuário">
            <p id="welcomeMessage"></p>
        </section>

        <!-- Conteúdo de Login -->
        <section class="login-content" id="loginContent">
            <div class="login-illustration">
                <div class="illustration-circle" aria-hidden="true">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 7V17C4 18.1046 4.89543 19 6 19H18C19.1046 19 20 18.1046 20 17V7C20 5.89543 19.1046 5 18 5H6C4.89543 5 4 5.89543 4 7Z" stroke="#4A5568" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 11C13.1046 11 14 10.1046 14 9C14 7.89543 13.1046 7 12 7C10.8954 7 10 7.89543 10 9C10 10.1046 10.8954 11 12 11Z" stroke="#4A5568" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M9 14H15" stroke="#4A5568" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h1>Quest!</h1>
                <p>A sua plataforma inteligente de criação de questões.</p>
            </div>

            <!-- Formulário -->
            <form id="loginForm" class="login-form" novalidate>
                <h3>Login</h3>
                <div id="errorMessage" class="flash-message login-error" role="alert" hidden></div>

                <div class="input-group">
                    <label for="email" class="sr-only">Email</label>
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="email" name="email" placeholder="Email" autocomplete="username" required>
                </div>

                <div class="input-group">
                    <label for="senha" class="sr-only">Senha</label>
                    <i class="fas fa-lock"></i>
                    <input type="password" id="senha" name="senha" placeholder="Senha" autocomplete="current-password" required>
                </div>

                <button type="submit" class="btn-login">Entrar</button>

                <div class="login-links">
                    <a href="#">Esqueceu a senha?</a>
                </div>
            </form>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginForm = document.getElementById('loginForm');
            const loginContainer = document.getElementById('loginContainer');
            const loginContent = document.getElementById('loginContent');
            const welcomeContainer = document.getElementById('welcomeContainer');
            const welcomeAvatar = document.getElementById('welcomeAvatar');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const errorMessage = document.getElementById('errorMessage');

            loginForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                errorMessage.hidden = true;

                const formData = new FormData(loginForm);

                try {
                    const response = await fetch("{{ url_for('login') }}", {
                        method: 'POST',
                        body: formData,
                    });

                    const data = await response.json();

                    if (data.success) {
                        welcomeMessage.textContent = `Bem-vindo, ${data.user.nome_completo}!`;
                        welcomeAvatar.src = data.user.foto_perfil_url || "{{ url_for('static', filename='images/default-avatar.svg') }}";

                        loginContainer.classList.add('animating');
                        welcomeContainer.hidden = false;

                        setTimeout(() => {
                            window.location.href = "{{ url_for('painel') }}";
                        }, 2500);
                    } else {
                        errorMessage.textContent = data.message;
                        errorMessage.hidden = false;
                    }
                } catch {
                    errorMessage.textContent = 'Ocorreu um erro de rede. Tente novamente.';
                    errorMessage.hidden = false;
                }
            });
        });
    </script>
</body>
</html>
